from __future__ import print_function
import os
import sys
import json
import requests
import argparse
import traceback
from bs4 import BeautifulSoup
import pandas as pd
stationgeo = \
'https://raw.githubusercontent.com/PeHMeteoN/ScrappingToolKit/master/PE_SENAMHI_HIDROMETEOROLOGY/senh_hist.json'
def add_altitude(code, state, type_station, category_station, old_code=None):
if state == "AUTOMATICA":
url = "https://www.senamhi.gob.pe/mapas/mapa-estaciones-2/map_red_graf.php?cod={}&estado={}&tipo_esta={}&cate={}".format(code, state, type_station, category_station)
else:
url = "https://www.senamhi.gob.pe/mapas/mapa-estaciones-2/map_red_graf.php?cod={}&estado={}&tipo_esta={}&cate={}&cod_old={}".format(code, state, type_station, category_station, old_code)
response = requests.get(url)
soup = BeautifulSoup(response.text, "html.parser")
for s in soup.find_all("td"):
if len(s) > 0:
if "msnm" in s.text:
alt = s.text.split(" ")[0]
return alt
a = 0
stationgeo = requests.get(stationgeo)
stationgeo
for z in stationgeo:
print(z)
for z in stationgeo:
print(type(z))
stationgeo = \
'https://raw.githubusercontent.com/PeHMeteoN/ScrappingToolKit/master/PE_SENAMHI_HIDROMETEOROLOGY/senh_hist.json'
stationgeo = requests.get(stationgeo)
stationgeo
json.loads(stationgeo.content)
stationgeo.content
stationgeo = \
'https://raw.githubusercontent.com/PeHMeteoN/ScrappingToolKit/master/PE_SENAMHI_HIDROMETEOROLOGY/senh_hist.json'
stationgeo = requests.get(stationgeo)
stationgeo = json.loads(stationgeo.content)
stationgeo
a = 0
for e in stationgeo:
print(e)
a = 0
for e in stationgeo:
print(a)
if "cod_old" in e.keys():
alt = add_altitude(e["cod"], e["estado"], e["ico"], e["cate"], e["cod_old"])
else:
alt = add_altitude(e["cod"], e["estado"], e["ico"], e["cate"])
est[a]["alt"] = alt
a += 1
a = 0
for e in stationgeo:
print(a)
if "cod_old" in e.keys():
alt = add_altitude(e["cod"], e["estado"], e["ico"], e["cate"], e["cod_old"])
else:
alt = add_altitude(e["cod"], e["estado"], e["ico"], e["cate"])
stationgeo[a]["alt"] = alt
a += 1
